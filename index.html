<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveOps: Performance & Automation 2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #0f172a; overflow-x: hidden; }
        .peya-red { color: #E21B23; }
        .peya-bg-red { background-color: #E21B23; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.04); padding: 2rem; border: 1px solid #e2e8f0; position: relative; }
        .chart-container { position: relative; height: 450px; width: 100%; }
        
        /* Estilo para la caja de Storytelling Interactiva */
        #story-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            background: rgba(255, 255, 255, 0.98);
            border-left: 5px solid #E21B23;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            padding: 1.5rem;
            border-radius: 12px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        #story-overlay.active {
            opacity: 1;
            top: 40px;
        }
        .stat-badge {
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            padding: 2px 8px;
            border-radius: 4px;
            background: #f1f5f9;
            color: #64748b;
            display: inline-block;
        }

        /* Estilos para la l√≠nea de tiempo Stagnant */
        .timeline-node {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 4px solid #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 0.7rem;
            color: #94a3b8;
            z-index: 10;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            cursor: pointer;
        }
        .timeline-item:hover .timeline-node {
            border-color: #E21B23;
            color: #E21B23;
            transform: scale(1.1);
        }
        .timeline-item:hover .state-tag {
            background: #fef2f2;
            color: #E21B23;
            border-color: #fecaca;
        }
        .state-tag {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 0.65rem;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            transition: all 0.2s;
            white-space: nowrap;
            cursor: pointer;
        }
        /* POPUP PARA GR√ÅFICOS DE TIMELINE */
        .timeline-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
            padding: 1.5rem;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            max-width: 600px;
            width: 90vw;
        }
        .timeline-popup.active {
            opacity: 1;
            visibility: visible;
        }
        .timeline-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .timeline-popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .timeline-popup-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: #E21B23;
            margin-bottom: 1rem;
            text-transform: uppercase;
        }
        .timeline-popup img {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* Estilos para la definici√≥n de Stagnant */
        .state-chip {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            transition: all 0.2s;
        }
        .state-chip:hover {
            border-color: #E21B23;
            color: #E21B23;
            background: #fffafa;
        }
        .flow-line {
            height: 2px;
            background: #e2e8f0;
            flex-grow: 1;
            margin: 0 8px;
        }

        /* Estilos para los Logros */
        .achievement-card {
            background: #ffffff;
            border: 1px solid #f1f5f9;
            padding: 1.25rem;
            border-radius: 16px;
            transition: transform 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .achievement-card:hover {
            transform: translateY(-2px);
            border-color: #fee2e2;
        }
        .case-study-card {
            background: #f8fafc;
            border-top: 4px solid #E21B23;
            padding: 1rem;
            border-radius: 12px;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }
        .case-study-card:hover {
            background: #ffffff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .case-study-graphics {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
            grid-column: 1 / -1;
            animation: slideDown 0.3s ease-out;
        }
        .case-study-graphics.active {
            display: grid;
        }
        .case-study-graphics.two-cols {
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        .case-study-graphics.one-col {
            grid-template-columns: 1fr;
        }
        .case-study-graphics img {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .case-study-graphics img:hover {
            transform: scale(1.02);
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* MODAL DE IM√ÅGENES */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .image-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .image-modal-content {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: auto;
        }
        .image-modal img {
            max-width: 90vw;
            max-height: 90vh;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            color: white;
            transition: all 0.2s ease;
        }
        .image-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        /* L√ìGICA DE CARRUSEL INFINITO */
        @keyframes scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .carousel-wrapper { width: 100%; overflow: hidden; }
        .stack-carousel {
            display: flex;
            width: max-content;
            animation: scroll 40s linear infinite;
        }
        .stack-carousel:hover { animation-play-state: paused; }
        .stack-item {
            flex: 0 0 auto;
            width: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        .arrow-flow {
            flex: 0 0 auto;
            color: #E21B23;
            font-size: 24px;
            font-weight: 900;
            display: flex;
            align-items: center;
            padding: 0 10px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.3; transform: translateX(-5px); }
            50% { opacity: 1; transform: translateX(5px); }
            100% { opacity: 0.3; transform: translateX(-5px); }
        }

        /* Tabs T√©cnicas */
        .tech-tab {
            transition: all 0.3s ease;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .tech-tab.active {
            border-bottom-color: #E21B23;
            color: #E21B23;
            font-weight: 800;
        }

        
        /* Estilo Link GitHub */
        .github-link {
            display: contents;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            background: #f1f5f9;
            color: #475569;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
        }
        .github-link:hover {
            background: #e2e8f0;
            color: #0f172a;
            border-color: #cbd5e1;
        }

        /* L√ìGICA DE MATRIZ */
        .logic-table th { background-color: #f8fafc; text-transform: uppercase; font-size: 10px; letter-spacing: 0.05em; padding: 12px; color: #64748b; font-weight: 800; }
        .logic-table td { padding: 12px; font-size: 11px; border-bottom: 1px solid #f1f5f9; }
        .check-icon { color: #10b981; font-weight: bold; }
        .cross-icon { color: #cbd5e1; }

    </style>
</head>
<body class="p-10">

    <div class="max-w-6xl mx-auto">
        <!-- HEADER EJECUTIVO -->
        <div class="flex justify-between items-end mb-10 border-b pb-6">
            <div>
                <h1 class="text-4xl font-800 tracking-tighter">LiveOps <span class="peya-red">Engine</span> Performance</h1>
                <p class="text-slate-500 uppercase text-xs font-bold tracking-[0.2em] mt-2">Automation 3rd Layer | Data 2025</p>
            </div>
            <div class="text-right">
                <p class="text-[10px] font-bold text-slate-400 uppercase">Hito Automation 2025</p>
                <p class="text-3xl font-800 peya-red">47,288 <span class="text-sm font-normal text-slate-400 text-slate-400">√ìrdenes</span></p>
            </div>
        </div>

        <!-- SECCI√ìN INTRODUCTORIA REDISE√ëADA -->
        <div class="card mb-10 border-t-8 border-t-red-600">
            <div class="mb-10">
                <h2 class="text-3xl font-800 tracking-tight mb-4 italic text-slate-800">¬øQu√© es una Orden <span class="peya-red">Stagnant</span>?</h2>
                <div class="flex flex-col md:flex-row md:items-end justify-between gap-6">
                    <p class="text-slate-600 text-lg leading-relaxed max-w-4xl">
                        Es una orden "estancada" que, ya sea por bugs de sistema o mala pr√°ctica del rider, permanece en un estado operativo por un tiempo superior al umbral √≥ptimo, generando fricci√≥n en la experiencia de usuarios, partners y riders.
                        <br>
                        En 2025 un 12.6% de las √≥rdenes CL estuvieron detenidas al menos 20 minutos en alguno de los principales estados en ciclo de vida de la orden.
                    </p>
                    <div class="flex flex-col gap-3 bg-slate-50 p-4 rounded-xl border border-slate-100 shrink-0">
                        <div class="flex items-center gap-3">
                            <span class="flex h-3 w-3 rounded-full peya-bg-red animate-pulse"></span>
                            <p class="text-[10px] font-black uppercase text-slate-500 tracking-tighter">
                                MAYOR RIESGO FAIL RATE
                            </p>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="flex h-3 w-3 rounded-full peya-bg-red animate-pulse"></span>
                            <p class="text-[10px] font-black uppercase text-slate-500 tracking-tighter">
                                M√ÅS INEFICIENCIAS OPERATIVAS
                            </p>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="flex h-3 w-3 rounded-full peya-bg-red animate-pulse"></span>
                            <p class="text-[10px] font-black uppercase text-slate-500 tracking-tighter">
                                PEORES EXPERIENCIAS DE USUARIO
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- L√çNEA DE TIEMPO FULL WIDTH -->
            <div class="w-full relative py-12">
                <div class="absolute top-[83px] left-0 w-full h-1 bg-slate-100 z-0"></div>
                <div class="relative z-10 flex flex-nowrap justify-between items-start gap-2 overflow-x-auto pt-4 pb-4 px-4">
                    <div class="flex flex-col items-center timeline-item group" data-state="sin-send-to-vendor">
                        <div class="timeline-node mb-4">01</div>
                        <div class="state-tag">Sin Send to Vendor</div>
                    </div>
                    <div class="flex flex-col items-center timeline-item group" data-state="dispatch" data-graph="stack/total_dispatched.png" onclick="showTimelinePopup(event)">
                        <div class="timeline-node mb-4">02</div>
                        <div class="state-tag">Dispatch</div>
                    </div>
                    <div class="flex flex-col items-center timeline-item group" data-state="accepted" data-graph="stack/total_accepted.png" onclick="showTimelinePopup(event)">
                        <div class="timeline-node mb-4">03</div>
                        <div class="state-tag">Accepted</div>
                    </div>
                    <div class="flex flex-col items-center timeline-item group" data-state="near-pickup" data-graph="stack/total_near_pickup.png" onclick="showTimelinePopup(event)">
                        <div class="timeline-node mb-4">04</div>
                        <div class="state-tag">Near Pickup</div>
                    </div>
                    <div class="flex flex-col items-center timeline-item group" data-state="picked-up" data-graph="stack/total_picked_up.png" onclick="showTimelinePopup(event)">
                        <div class="timeline-node mb-4">05</div>
                        <div class="state-tag">Picked Up</div>
                    </div>
                    <div class="flex flex-col items-center timeline-item group" data-state="left-pickup" data-graph="stack/total_left_pickup.png" onclick="showTimelinePopup(event)">
                        <div class="timeline-node mb-4">06</div>
                        <div class="state-tag">Left Pickup</div>
                    </div>
                    <div class="flex flex-col items-center timeline-item group" data-state="near-dropoff" data-graph="stack/total_near_dropoff.png" onclick="showTimelinePopup(event)">
                        <div class="timeline-node mb-4">07</div>
                        <div class="state-tag">Near Dropoff</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 gap-10">
            
            <!-- GR√ÅFICO 1: EVOLUCI√ìN DE LA AUTOMATIZACI√ìN (CON STORYTELLING) -->
            <div class="card overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 class="text-2xl font-bold tracking-tight">Evoluci√≥n Operativa</h2>
                        <p class="text-slate-400 text-sm">Pasa el cursor sobre los meses para ver el detalle t√°ctico</p>
                    </div>
                    <div class="flex gap-4">
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full peya-bg-red"></span>
                            <span class="text-xs font-bold text-slate-600 uppercase">Engine</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-slate-300"></span>
                            <span class="text-xs font-bold text-slate-600 uppercase">Manual</span>
                        </div>
                    </div>
                </div>

                <!-- CAJA DE STORYTELLING DIN√ÅMICA -->
                <div id="story-overlay">
                    <div class="flex justify-between items-center">
                        <span id="story-month" class="text-lg font-800 peya-red uppercase tracking-widest">ENERO</span>
                        <span id="story-tag" class="stat-badge">Hito Operativo</span>
                    </div>
                    <p id="story-text" class="text-slate-700 text-sm leading-relaxed font-medium">
                        Selecciona un mes para ver el contexto.
                    </p>
                </div>
                
                <div class="chart-container mt-12">
                    <canvas id="automationChart"></canvas>
                </div>

            
                <!-- LOGROS E INDICADORES DE √âXITO -->
                <div class="mt-10">
                    <p class="text-[10px] font-black uppercase text-slate-400 tracking-[0.2em] mb-4">Resultados Consolidados Diciembre</p>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div class="achievement-card">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl">ü§ñ</span>
                                <p class="text-[10px] uppercase font-black text-slate-400 tracking-wider leading-none">Share de<br>Automatizaci√≥n</p>
                            </div>
                            <p class="text-2xl font-800 peya-red">88%</p>
                            <p class="text-[10px] text-slate-500 mt-1">M√°ximo hist√≥rico alcanzado en Diciembre.</p>
                        </div>
                        
                        <div class="achievement-card">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl">üöÄ</span>
                                <p class="text-[10px] uppercase font-black text-slate-400 tracking-wider leading-none">Aumento de<br>Capacidad</p>
                            </div>
                            <p class="text-2xl font-800 peya-red">22.1k</p>
                            <p class="text-[10px] text-slate-500 mt-1">√ìrdenes gestionadas en un solo mes.</p>
                        </div>

                        <div class="achievement-card">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl">üéØ</span>
                                <p class="text-[10px] uppercase font-black text-slate-400 tracking-wider leading-none">Efectividad<br>Sostenida</p>
                            </div>
                            <p class="text-2xl font-800 peya-red">>86%</p>
                            <p class="text-[10px] text-slate-500 mt-1">Tasa de √©xito bajo alta demanda operacional.</p>
                        </div>

                        <div class="achievement-card border-red-100 bg-red-50/30">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="text-2xl">üèÜ</span>
                                <p class="text-[10px] uppercase font-black text-slate-400 tracking-wider leading-none">Hito de<br>Eficiencia</p>
                            </div>
                            <p class="text-xl font-800 text-slate-800">1 Mes ‚âà 1 A√±o</p>
                            <p class="text-[10px] text-slate-500 mt-1">Igualamos la gesti√≥n manual total de 2024.</p>
                        </div>
                    </div>

                    <p class="text-[10px] font-black uppercase text-slate-400 tracking-[0.2em] mb-4">Casos de √âxito T√°cticos</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="case-studies-container">
                        <div class="case-study-card" onclick="toggleGraphics(event, 'ndo')">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-lg">üìç</span>
                                <h3 class="text-xs font-800 uppercase tracking-tight">Caso Near Dropoff</h3>
                            </div>
                            <p class="text-[10px] text-slate-600 leading-snug">
                                <strong class="text-slate-900">Resultado: 0% Stagnant NDO.</strong> Eliminaci√≥n total de √≥rdenes estancadas mediante el ajuste de umbrales de autocomplete en √≥rdenes con PIN (180' ‚Üí 40').
                            </p>
                            <div class="case-study-graphics two-cols" id="ndo-graphics">
                                <img src="stack/gestion ice autocomplete.png" alt="Gesti√≥n ICE Autocomplete">
                                <img src="stack/share_gestion_stagnant.png" alt="Share Gesti√≥n Stagnant">
                            </div>
                        </div>
                        <div class="case-study-card" onclick="toggleGraphics(event, 'accepted')">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-lg">‚è±Ô∏è</span>
                                <h3 class="text-xs font-800 uppercase tracking-tight">Caso Accepted</h3>
                            </div>
                            <p class="text-[10px] text-slate-600 leading-snug">
                                <strong class="text-slate-900">Gesti√≥n Tercera Capa.</strong> Los automatismos (ICE) solo capturan entre el 20-30% de los casos. El Engine cubre el GAP restante reduciendo FR de 21.8% (Sin gesti√≥n) a 11.8% (Gesti√≥n √≥ptima).
                            </p>
                            <div class="case-study-graphics two-cols" id="accepted-graphics">
                                <img src="stack/accepted_1.png" alt="Accepted Case 1">
                                <img src="stack/accepted_2.png" alt="Accepted Case 2">
                            </div>
                        </div>
                        <div class="case-study-card" onclick="toggleGraphics(event, 'flota')">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-lg">‚ö°</span>
                                <h3 class="text-xs font-800 uppercase tracking-tight">Eficiencia de Flota</h3>
                            </div>
                            <p class="text-[10px] text-slate-600 leading-snug">
                                <strong class="text-slate-900">Reducci√≥n Fake Hours.</strong> Libera a rider para nuevos pedidos y corrige WH (3k - 5k horas falsas/mes ).
                            </p>
                            <div class="case-study-graphics one-col" id="flota-graphics">
                                <img src="stack/fake_wh.png" alt="Fake Working Hours">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GR√ÅFICO 2: EFECTIVIDAD -->
            <div class="card">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold tracking-tight">Efectividad de Gesti√≥n (EG%)</h2>
                    <p class="text-slate-400 text-sm italic">Proporci√≥n de √ìrdenes Confirmadas vs. Total Gesti√≥n</p>
                </div>
                
                <div class="chart-container" style="height: 300px;">
                    <canvas id="effectivenessChart"></canvas>
                </div>

                <div class="mt-8 flex items-center justify-between p-4 bg-slate-50 rounded-xl border-l-4 border-red-500">
                    <div>
                        <p class="text-sm font-bold text-slate-700">Insights de Rendimiento</p>
                        <p class="text-xs text-slate-500">A pesar del incremento masivo de volumen (+4x vs Agosto), la efectividad de gesti√≥n (EG) se mantiene estable sobre el 86%.</p>
                        <p class="text-xs text-slate-500">La mejora en la tasa de √©xito entre el Q1 y Q4 es de +21.3 pp.</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] uppercase font-bold text-slate-400">EG Q1-2025</p>
                        <p class="text-xl font-800 peya-red">67.3%</p>
                    </div>
                    <div class="text-center">
                        <p class="text-slate-500 font-500 peya-red">VS</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] uppercase font-bold text-slate-400">EG Q4-2025</p>
                        <p class="text-xl font-800 peya-red">89.0%</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="max-w-6xl mx-auto">
        <!-- SECCI√ìN T√âCNICA: HEADER EJECUTIVO -->
        <div class="flex justify-between items-end mt-16 mb-10 border-b pb-6">
            <div>
                <h1 class="text-4xl font-800 tracking-tighter">LiveOps <span class="peya-red">Engine</span> Architecture</h1>
                <p class="text-slate-500 uppercase text-xs font-bold tracking-[0.2em] mt-2">Automation 3rd Layer | Data 2025</p>
            </div>
        </div>

        <!-- SECCI√ìN ARQUITECTURA T√âCNICA (INTERACTIVA) -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-20">
            <div class="col-span-1 space-y-2">
                <p class="text-[10px] font-black uppercase text-slate-400 mb-4 tracking-widest">Capas del Proyecto</p>
                <div onclick="switchTech('dev')" id="tab-dev" class="tech-tab active p-4 rounded-xl bg-white border hover:shadow-md">
                    <p class="text-xs font-bold uppercase">01. Development</p>
                    <p class="text-[10px] text-slate-500">Python, SOLID & Seguridad</p>
                </div>
                <div onclick="switchTech('ui')" id="tab-ui" class="tech-tab p-4 rounded-xl bg-white border hover:shadow-md">
                    <p class="text-xs font-bold uppercase">02. Interface</p>
                    <p class="text-[10px] text-slate-500">PyQt5 & Paneles UI</p>
                </div>
                <div onclick="switchTech('ctrl')" id="tab-ctrl" class="tech-tab p-4 rounded-xl bg-white border hover:shadow-md">
                    <p class="text-xs font-bold uppercase">03. Controller</p>
                    <p class="text-[10px] text-slate-500">Patr√≥n MVC & Concurrencia</p>
                </div>
                
                
                <p class="text-[10px] font-black uppercase text-slate-400 mb-4 mt-6 tracking-widest">Documentaci√≥n</p>
                <div class="space-y-2">
                    <a href="https://gist.github.com/Jotaem/03aabe9e1d0beaa762ace1690f2e6472" target="_blank" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-white border hover:shadow-md transition-all duration-200 w-full">
                        <img src="https://cdn.worldvectorlogo.com/logos/github-icon-1.svg" class="h-5" alt="GitHub">
                        <span class="text-xs font-bold text-slate-800 uppercase">README.md</span>
                    </a>
                    <a href="https://gist.github.com/Jotaem/689cfdfea30c0a5bd42de3cccf5dd7fd" target="_blank" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-white border hover:shadow-md transition-all duration-200 w-full">
                        <img src="https://cdn.worldvectorlogo.com/logos/github-icon-1.svg" class="h-5" alt="GitHub">
                        <span class="text-xs font-bold text-slate-800 uppercase">DIRECTORIO.md</span>
                    </a>
                    <a href="https://gist.github.com/Jotaem/9b02a31b7c0b98fd33d64b62419fb2fb" target="_blank" class="flex items-center gap-3 px-4 py-3 rounded-xl bg-white border hover:shadow-md transition-all duration-200 w-full">
                        <img src="https://cdn.worldvectorlogo.com/logos/github-icon-1.svg" class="h-5" alt="GitHub">
                        <span class="text-xs font-bold text-slate-800 uppercase">ARCHITECTURE.md</span>
                    </a>
                </div>
            </div>

            <div class="col-span-3 card min-h-[500px]" id="tech-content">
                <!-- Inyectado v√≠a JS -->
            </div>
        </div>

    
        <!-- SECCI√ìN STACK FLOW -->
        <div class="card mb-10 bg-slate-800 overflow-hidden py-8">
            <p class="text-[10px] font-white uppercase text-red-500 tracking-[0.3em] mb-8 text-center">Stagnant Execution Flow</p>
            <div class="stack-carousel">
                <div class="stack-item"><img src="stack/bigquery.svg" class="h-12" alt="BigQuery"><span class="text-white text-[10px] font-bold uppercase">BigQuery</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="https://www.gstatic.com/images/branding/product/2x/sheets_64dp.png" class="h-12" alt="Sheets"><span class="text-white text-[10px] font-bold uppercase">G-Sheets</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="https://cdn.worldvectorlogo.com/logos/python-5.svg" class="h-12" alt="Python Engine"><span class="text-white text-[10px] font-bold uppercase italic">Engine</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="stack/selenium.png" class="h-12" alt="Selenium"><span class="text-white text-[10px] font-bold uppercase">Selenium</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="stack/hurrier.png" class="h-12 w-12 rounded-full object-cover bg-white p-1" alt="Hurrier"><span class="text-white text-[10px] font-bold uppercase">Hurrier</span></div>
            </div>
        </div>

        <!-- SECCI√ìN STACK FLOW -->
        <div class="card mb-10 bg-slate-800 overflow-hidden py-8">
            <p class="text-[10px] font-white uppercase text-red-500 tracking-[0.3em] mb-8 text-center">Reporting Execution Flow</p>
            <div class="stack-carousel">
                <div class="stack-item"><img src="https://cdn.worldvectorlogo.com/logos/python-5.svg" class="h-12" alt="Python Engine"><span class="text-white text-[10px] font-bold uppercase italic">Engine</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="stack/hurrier.png" class="h-12 w-12 rounded-full object-cover bg-white p-1" alt="Hurrier"><span class="text-white text-[10px] font-bold uppercase">Hurrier</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="https://cdn.worldvectorlogo.com/logos/grafana.svg" class="h-12" alt="Grafana"><span class="text-white text-[10px] font-bold uppercase">Grafana</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="https://www.gstatic.com/images/branding/product/2x/sheets_64dp.png" class="h-12" alt="Sheets"><span class="text-white text-[10px] font-bold uppercase">G-Sheets</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="stack/slack.png" class="h-12" alt="Slack"><span class="text-white text-[10px] font-bold uppercase">Slack</span></div>
            </div>
        </div>

        <!-- SECCI√ìN STACK FLOW -->
        <div class="card mb-10 bg-slate-800 overflow-hidden py-8">
            <p class="text-[10px] font-white uppercase text-red-500 tracking-[0.3em] mb-8 text-center">DAS Events Execution Flow</p>
            <div class="stack-carousel">
                <div class="stack-item"><img src="stack/hurrier.png" class="h-12 w-12 rounded-full object-cover bg-white p-1" alt="Hurrier"><span class="text-white text-[10px] font-bold uppercase">Hurrier</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="stack/bigquery.svg" class="h-12" alt="BigQuery"><span class="text-white text-[10px] font-bold uppercase">BigQuery</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="stack/gemini.png" class="h-12" alt="Gemini"><span class="text-white text-[10px] font-bold uppercase">Gemini</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="https://cdn.worldvectorlogo.com/logos/python-5.svg" class="h-12" alt="Python Engine"><span class="text-white text-[10px] font-bold uppercase italic">Engine</span></div>
                <div class="flex items-center arrow-flow px-4"><span class="text-2xl">‚Üí</span></div>
                <div class="stack-item"><img src="stack/das.jpg" class="h-12" alt="DAS"><span class="text-white text-[10px] font-bold uppercase">DAS</span></div>
            </div>
        </div>

        <!-- NUEVA SECCI√ìN: MATRIZ DE DECISI√ìN Y L√ìGICA -->
            <div class="mt-20">
                <div class="flex justify-between items-end mb-10 border-b pb-6">
                    <div>
                        <h1 class="text-4xl font-800 tracking-tighter">L√≥gica de Gesti√≥n <span class="peya-red">Stagnant</span></h1>
                        <p class="text-slate-500 uppercase text-xs font-bold tracking-[0.2em] mt-2">Matriz de Decisi√≥n y Protocolos de Acci√≥n | Analytics Deep-Dive</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
                    <!-- MATRIZ DE DECISI√ìN -->
                    <div class="md:col-span-2 card overflow-x-auto">
                        <h3 class="text-xl font-800 uppercase text-slate-800 mb-6 italic border-l-4 border-red-500 pl-3">Matriz de Validaci√≥n (Decision Matrix)</h3>
                        <table class="w-full text-left logic-table">
                            <thead>
                                <tr>
                                    <th>Stagnant Type</th>
                                    <th>Umbral</th>
                                    <th>Status Rider</th>
                                    <th>Stacked?</th>
                                    <th>Distancia</th>
                                    <th>Acci√≥n Motor</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="font-bold text-slate-700">Send to Vendor</td>
                                    <td class="font-bold">15 min</td>
                                    <td class="cross-icon">-</td>
                                    <td class="cross-icon">-</td>
                                    <td class="cross-icon">-</td>
                                    <td class="peya-red font-800 uppercase italic">[Al3] Update & STV</td>
                                </tr>
                                <tr>
                                    <td class="font-bold text-slate-700">Queued</td>
                                    <td class="font-bold">Config</td>
                                    <td class="cross-icon">-</td>
                                    <td class="cross-icon">-</td>
                                    <td class="cross-icon">-</td>
                                    <td class="peya-red font-800 uppercase italic">[Al3] Dispatch</td>
                                </tr>
                                <tr>
                                    <td class="font-bold text-slate-700">Dispatched</td>
                                    <td class="font-bold">25 min</td>
                                    <td class="cross-icon">-</td>
                                    <td class="cross-icon">-</td>
                                    <td class="cross-icon">-</td>
                                    <td class="peya-red font-800 uppercase italic">[Al3] Forced Accept</td>
                                </tr>
                                <tr>
                                    <td class="font-bold text-slate-700">Accepted</td>
                                    <td class="font-bold">20 min</td>
                                    <td class="check-icon">‚úì Break / Off</td>
                                    <td class="cross-icon">-</td>
                                    <td class="check-icon">‚úì > 200m</td>
                                    <td class="peya-red font-800 uppercase italic">[Al3] Undispatch & Reasign</td>
                                </tr>
                                <tr>
                                    <td class="font-bold text-slate-700">Near Pickup</td>
                                    <td class="font-bold">40 min</td>
                                    <td class="check-icon">‚úì Break / Off</td>
                                    <td class="cross-icon">-</td>
                                    <td class="check-icon">‚úì > 100m</td>
                                    <td class="peya-red font-800 uppercase italic">[Al3] Reasign (Hard/Soft)</td>
                                </tr>
                                <tr>
                                    <td class="font-bold text-slate-700">Picked Up</td>
                                    <td class="font-bold">40 min</td>
                                    <td class="cross-icon">-</td>
                                    <td class="check-icon">‚úì Sin Stacking</td>
                                    <td class="cross-icon">-</td>
                                    <td class="peya-red font-800 uppercase italic">[Al3] Complete Order</td>
                                </tr>
                                <tr>
                                    <td class="font-bold text-slate-700">Left Pickup</td>
                                    <td class="font-bold">40 min</td>
                                    <td class="cross-icon">-</td>
                                    <td class="check-icon">‚úì Sin Stacking</td>
                                    <td class="cross-icon">-</td>
                                    <td class="peya-red font-800 uppercase italic">[Al3] Complete Order</td>
                                </tr>
                                <tr>
                                    <td class="font-bold text-slate-700">Near Dropoff</td>
                                    <td class="font-bold">40 min</td>
                                    <td class="cross-icon">-</td>
                                    <td class="cross-icon">-</td>
                                    <td class="check-icon">‚úì < 100m</td>
                                    <td class="peya-red font-800 uppercase italic">[Al3] Complete Order</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- EVIDENCIA BOT -->
                    <div class="card flex flex-col justify-between border-2 border-dashed border-red-200">
                        <div>
                            <h3 class="text-xl font-800 uppercase text-slate-800 mb-4 italic">Evidencia Trazabilidad</h3>
                            <p class="text-xs text-slate-500 leading-relaxed mb-6">El Engine no solo act√∫a; deja una huella digital para auditor√≠a. Cada acci√≥n incluye una nota estructurada con el motivo, umbral superado y timestamp.</p>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-2 border border-slate-200 h-64 flex items-center justify-center relative overflow-hidden group">
                            <img src="stack/bot_note_example.png" onerror="this.src='https://placehold.co/400x500?text=Adjuntar+Captura+Notas+Bot';" class="rounded shadow-sm object-contain w-full h-full grayscale group-hover:grayscale-0 transition-all">
                            <div class="absolute inset-0 bg-slate-900/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-all cursor-pointer">
                                <span class="text-white text-[10px] font-black uppercase tracking-widest">Ejemplo Nota bot_engine</span>
                            </div>
                        </div>
                        <p class="text-[9px] text-center text-slate-400 mt-4 italic uppercase">Formato: [Al3-Engine] {Estado} | {Motivo}</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- ACCIONES PREVIAS -->
                    <div class="card bg-slate-50 border-none">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center text-white font-black text-xs">PRE</div>
                            <h3 class="text-lg font-800 uppercase text-slate-800 italic">Protocolo Pre-Acci√≥n</h3>
                        </div>
                        <ul class="space-y-4">
                            <li class="flex gap-3">
                                <span class="text-red-500 font-bold">1.</span>
                                <p class="text-xs font-semibold text-slate-700">Sincronizaci√≥n BigQuery-Sheets: Filtrado de √≥rdenes con >X minutos de estancamiento.</p>
                            </li>
                            <li class="flex gap-3">
                                <span class="text-red-500 font-bold">2.</span>
                                <p class="text-xs font-semibold text-slate-700">Validaci√≥n de Exclusi√≥n: El motor verifica si la ciudad o zona est√° en la "lista blanca" de gesti√≥n activa.</p>
                            </li>
                            <li class="flex gap-3">
                                <span class="text-red-500 font-bold">3.</span>
                                <p class="text-xs font-semibold text-slate-700">Health Check Driver: Confirmaci√≥n de sesi√≥n Okta activa antes de iniciar scraping individual.</p>
                            </li>
                        </ul>
                    </div>

                    <!-- ACCIONES POSTERIORES -->
                    <div class="card bg-red-50/30 border-none">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-10 h-10 rounded-full peya-bg-red flex items-center justify-center text-white font-black text-xs">POST</div>
                            <h3 class="text-lg font-800 uppercase text-slate-800 italic">Protocolo Post-Acci√≥n</h3>
                        </div>
                        <ul class="space-y-4">
                            <li class="flex gap-3">
                                <span class="text-red-500 font-bold">1.</span>
                                <p class="text-xs font-semibold text-slate-700">Escritura de Log en Hurrier: Inyecci√≥n de nota t√©cnica para visibilidad de los analistas manuales.</p>
                            </li>
                            <li class="flex gap-3">
                                <span class="text-red-500 font-bold">2.</span>
                                <p class="text-xs font-semibold text-slate-700">Update Hist√≥rico: Registro de la gesti√≥n exitosa en la base de datos de impacto (Rising LiveOps).</p>
                            </li>
                            <li class="flex gap-3">
                                <span class="text-red-500 font-bold">3.</span>
                                <p class="text-xs font-semibold text-slate-700">Notificaci√≥n Slack (Alerting): Si la gesti√≥n falla tras 3 intentos, se deriva a canal de revisi√≥n manual.</p>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

        
            <!-- FOOTER EJECUTIVO -->
            <footer class="mt-20 border-t border-slate-200 pt-10 pb-20">
                <div class="flex flex-col md:flex-row justify-between items-center gap-8">
                    <div class="flex flex-col items-center md:items-start">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="w-2 h-2 rounded-full peya-bg-red"></span>
                            <span class="text-sm font-800 tracking-tighter uppercase">LiveOps <span class="peya-red">Engine</span> Excellence</span>
                        </div>
                        <p class="text-[10px] text-slate-400 font-medium uppercase tracking-widest">Desarrollado para la optimizaci√≥n de flota y log√≠stica</p>
                    </div>
                    
                    <div class="flex items-center gap-10">
                        <div class="text-center md:text-right">
                            <p class="text-[10px] font-black text-slate-400 uppercase mb-1">Autor del Proyecto</p>
                            <p class="text-sm font-bold text-slate-700">Jonathan Matus</p>
                        </div>
                        <div class="h-8 w-[1px] bg-slate-200 hidden md:block"></div>
                        <div class="text-center md:text-right">
                            <p class="text-[10px] font-black text-slate-400 uppercase mb-1">√öltima Actualizaci√≥n</p>
                            <p class="text-sm font-bold text-slate-700">Enero 2026</p>
                        </div>
                    </div>

                    <div class="flex items-center gap-4">
                        <a href="https://github.com/Jotaem/Automatizacion_LiveOps3.0" target="_blank" class="github-link">
                            <img src="https://cdn.worldvectorlogo.com/logos/github-icon-1.svg" class="h-4" alt="GitHub Logo">
                            C√≥digo Fuente
                        </a>
                    </div>
                </div>
                <div class="mt-10 text-center">
                    <p class="text-[9px] text-slate-300 font-bold uppercase tracking-[0.4em]">Efficiency ¬∑ Scalability ¬∑ Innovation</p>
                </div>
            </footer>
    </div>

    <!-- MODAL DE IM√ÅGENES -->
    <div class="image-modal" id="imageModal" onclick="closeImageModal()">
        <div class="image-modal-content" onclick="event.stopPropagation()">
            <div class="image-modal-close" onclick="closeImageModal()">‚úï</div>
            <img id="modalImage" src="" alt="Gr√°fico expandido">
        </div>
    </div>

    <!-- POPUP PARA GR√ÅFICOS DE TIMELINE -->
    <div class="timeline-popup-overlay" id="timelinePopupOverlay" onclick="closeTimelinePopup()"></div>
    <div class="timeline-popup" id="timelinePopup" onclick="event.stopPropagation()">
        <div class="timeline-popup-title" id="timelinePopupTitle"></div>
        <img id="timelinePopupImage" src="" alt="Gr√°fico timeline">
    </div>

    <script>

        <!-- LIVEOPS ENGINE ARCHITECTURE -->
        // DATOS T√âCNICOS
        const techData = {
            dev: {
                title: "01. Desarrollo (Python Al3)",
                desc: "Soluci√≥n local que act√∫a como tercera capa de gesti√≥n sobre las limitaciones de Hurrier e ICE.",
                bullets: [
                    "Dise√±o bajo principios SOLID para escalabilidad y robustez.",
                    "Seguridad: Login manual en Okta y credenciales encriptadas.",
                    "Entorno Seguro: Servidor local sin exposici√≥n en la nube p√∫blica.",
                    "Documentaci√≥n: Repositorio privado con README y Architecture Docs."
                ],
                image: "stack/documentacion.gif"
            },
            ui: {
                title: "02. Interface Layer (PyQt5 Panels)",
                desc: "Interfaz gr√°fica moderna y modular construida con PyQt5 para una navegaci√≥n fluida, emulando la eficiencia de una hoja de c√°lculo.",
                bullets: [
                    "Paneles Principales: Reporting, Stagnant y DAS.",
                    "Herramientas: Dashboard personalizable de enlaces t√°cticos.",
                    "Schedulers: Control de ejecuci√≥n autom√°tica (Dual o 15-30-60 min).",
                    "Rider Care: Exclusi√≥n din√°mica de ciudades en tiempo real y no tocar ciudades que requieran una revisi√≥n manual caso a caso (paro)",
                    "Configuraci√≥n: Login de usuario, feedback auditivo, seteo de canales y umbrales."
                ],
                image: "stack/interfaz.gif"
            },
            ctrl: {
                title: "03. Controller Layer (Patr√≥n MVC)",
                desc: "Motor central (app_controller.py) que desacopla completamente la interfaz gr√°fica de la l√≥gica de negocio. La UI emite se√±ales; el controlador orquesta la ejecuci√≥n.",
                bullets: [
                    "Concurrencia Segura: Gesti√≥n simult√°nea de tareas manuales y autom√°ticas.",
                    "Multi-threading: Drivers independientes (Visible para usuario, Headless para Schedulers).",
                    "Trazabilidad: Captura de excepciones y logs espec√≠ficos por hilo de ejecuci√≥n.",
                    "Cero UI Freezing: Procesamiento as√≠ncrono que garantiza la respuesta de la interfaz."
                ],
                image: "stack/ejecucion_bot.gif"
            }
        };

        function switchTech(key) {
            const data = techData[key];
            const container = document.getElementById('tech-content');
            document.querySelectorAll('.tech-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + key).classList.add('active');

            container.innerHTML = `
                <div class="animate-fadeIn">
                    <h2 class="text-2xl font-800 peya-red mb-4 italic">${data.title}</h2>
                    <p class="text-slate-600 mb-6 text-sm leading-relaxed">${data.desc}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <ul class="space-y-3">
                            ${data.bullets.map(b => `<li class="flex items-center gap-2 text-xs font-bold text-slate-700"><span class="text-red-500 text-lg leading-none">‚úì</span> ${b}</li>`).join('')}
                        </ul>
                        <div class="bg-slate-100 rounded-xl p-4 border-2 border-dashed border-slate-300 flex flex-col items-center justify-center">
                            <img src="${data.image}" onerror="this.src='https://placehold.co/400x250?text=Cargar+Captura+${key}';" class="rounded shadow-lg max-h-50 mb-2">
                        </div>
                    </div>
                </div>
            `;
        }

        const mesesLabels = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

        // DATA REAL VALIDADA
        const dataEngine = [0, 0, 0, 0, 0, 0, 0, 4418, 3506, 7374, 12536, 19454];
        const dataManual = [521, 1281, 1563, 1717, 3730, 4491, 5230, 4672, 2950, 2780, 2677, 2703];
        const dataEfectividad = [68.57, 62.53, 69.87, 68.03, 80.88, 83.12, 86.21, 89.33, 85.05, 84.54, 87.24, 86.96];

        // CONTENIDO DE STORYTELLING
        const hitosDetallados = [
            "Escenario anterior: Dotaci√≥n incompleta, sufr√≠amos estresando la capacidad humana para gestionar 1.2k-1.6k √≥rdenes mensuales.",
            "Escenario anterior: Dotaci√≥n incompleta, sufr√≠amos estresando la capacidad humana para gestionar 1.2k-1.6k √≥rdenes mensuales.",
            "Escenario anterior: Dotaci√≥n incompleta, sufr√≠amos estresando la capacidad humana para gestionar 1.2k-1.6k √≥rdenes mensuales.",
            "Escenario anterior: Dotaci√≥n incompleta, sufr√≠amos estresando la capacidad humana para gestionar 1.2k-1.6k √≥rdenes mensuales.",
            "Punto de Inflexi√≥n: Se aumenta umbral de autocomplete en √≥rdenes con PIN a 180 min (vs 20 min las que no tienen PIN), crecen las stagnant en near dropoff y afectaci√≥n operacional a nivel pa√≠s.",
            "Estr√©s Cr√≠tico: Dotaci√≥n completa y capacidad humana estresada por foco en √≥rdenes stagnant + multitarea operativa intensa.",
            "Estr√©s Cr√≠tico: Dotaci√≥n completa y capacidad humana estresada por multitarea, exige reestructuraci√≥n de flujos y prioridades, para liberar capacidad para gesti√≥n de √≥rdenes Stagnant.", 
            "Fase Experimental: Se integra data live para detecci√≥n temprana. Comienza el desarrollo del Engine en fase testing gestionando stagnant en NDO. Se gestionan +5.1k √≥rdenes con un FR de 0.1% (Bajo riesgo).",
            "Ajuste Estrat√©gico: Business Case de agosto permite que Regional ajuste umbral de 180 a 40 min (2da semana): Stagnant en NDO desaparecen (0%). Automatizaci√≥n 54%.",
            "Gesti√≥n Proactiva: Implementaci√≥n de gesti√≥n autonoma \"Scheduler\" cada 15 min. Transici√≥n a gesti√≥n proactiva permite superar las 10 mil √≥rdenes gestionadas con share de automatizaci√≥n del 72%.",
            "Escalabilidad Real: Se ajusta umbral de gesti√≥n de \"Stagnant Accepted\" a >20 min. Automatizaci√≥n alcanza el 82% sobre un volumen masivo de 15 mil √≥rdenes.",
            "Prueba de Fuego: Implementaci√≥n Engine Dual. Superamos las 22 mil √≥rdenes (88% auto), igualando toda la gesti√≥n manual del 2024 en solo 31 d√≠as."
        ];

        // REFERENCIAS DOM
        const overlay = document.getElementById('story-overlay');
        const overlayMonth = document.getElementById('story-month');
        const overlayText = document.getElementById('story-text');

        // CHART 1: AUTOMATIZACI√ìN
        const ctxAuto = document.getElementById('automationChart').getContext('2d');
        const automationChart = new Chart(ctxAuto, {
            type: 'bar',
            data: {
                labels: mesesLabels,
                datasets: [
                    { label: 'Engine', data: dataEngine, backgroundColor: '#E21B23', borderRadius: 6 },
                    { label: 'Manual', data: dataManual, backgroundColor: '#cbd5e1', borderRadius: 6 }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    tooltip: { enabled: false } // Desactivamos el tooltip default para usar el nuestro
                },
                onHover: (event, activeElements) => {
                    if (activeElements.length > 0) {
                        const index = activeElements[0].index;
                        overlayMonth.innerText = mesesLabels[index];
                        overlayText.innerText = hitosDetallados[index];
                        overlay.classList.add('active');
                    } else {
                        overlay.classList.remove('active');
                    }
                },
                scales: {
                    x: { stacked: true, grid: { display: false }, ticks: { font: { weight: '700', size: 11 } } },
                    y: { 
                        stacked: true,
                        beginAtZero: true,
                        grid: { color: '#f1f5f9' },
                        ticks: { callback: v => v >= 1000 ? (v/1000) + 'k' : v }
                    }
                }
            },
            plugins: [{
                id: 'keyMonthIndicator',
                afterDatasetsDraw: (chart) => {
                    const { ctx, data, scales: { y } } = chart;
                    const keyMonths = [4, 7, 11]; // Mayo, Agosto, Diciembre

                    ctx.save();
                    ctx.font = '900 20px Inter';
                    ctx.fillStyle = 'rgba(226, 27, 35, 0.8)';
                    ctx.textAlign = 'center';

                    const metaEngine = chart.getDatasetMeta(0);

                    keyMonths.forEach(monthIndex => {
                        const total = data.datasets[0].data[monthIndex] + data.datasets[1].data[monthIndex];
                        if (metaEngine.data[monthIndex]) {
                            const xPos = metaEngine.data[monthIndex].x;
                            const yPos = y.getPixelForValue(total);
                            
                            ctx.fillText('!', xPos, yPos - 8);
                        }
                    });
                    ctx.restore();
                }
            }]
        });

        // CHART 2: EFECTIVIDAD
        const ctxEff = document.getElementById('effectivenessChart').getContext('2d');
        new Chart(ctxEff, {
            type: 'line',
            data: {
                labels: mesesLabels,
                datasets: [{
                    label: 'Efectividad %',
                    data: dataEfectividad,
                    borderColor: '#E21B23',
                    borderWidth: 4,
                    fill: true,
                    backgroundColor: 'rgba(226, 27, 35, 0.05)',
                    tension: 0.3,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#E21B23',
                    pointBorderWidth: 3,
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { font: { weight: '600', size: 10 } } },
                    y: { min: 50, max: 100, grid: { borderDash: [5, 5] }, ticks: { callback: v => v + '%' } }
                }
            }
        });

        // TOGGLE GRAPHICS FUNCTION FOR CASE STUDIES
        function toggleGraphics(event, caseId) {
            event.stopPropagation();
            const container = document.getElementById('case-studies-container');
            const graphicsId = caseId + '-graphics';
            const graphicsElement = document.getElementById(graphicsId);
            
            // Cerrar otros gr√°ficos abiertos
            document.querySelectorAll('.case-study-graphics.active').forEach(el => {
                if (el.id !== graphicsId) {
                    el.classList.remove('active');
                }
            });
            
            // Toggle actual
            graphicsElement.classList.toggle('active');
        }

        // FUNCIONES PARA MODAL DE IM√ÅGENES
        function openImageModal(imageSrc) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            modalImage.src = imageSrc;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // AGREGAR EVENT LISTENERS A LAS IM√ÅGENES DE GR√ÅFICOS
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.case-study-graphics img').forEach(img => {
                img.addEventListener('click', function(e) {
                    e.stopPropagation();
                    openImageModal(this.src);
                });
            });
        });

        // Cerrar gr√°ficos al hacer click fuera
        document.addEventListener('click', () => {
            document.querySelectorAll('.case-study-graphics.active').forEach(el => {
                el.classList.remove('active');
            });
        });

        // Cerrar modal con tecla ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageModal();
                closeTimelinePopup();
            }
        });

        // FUNCIONES PARA POPUP DE TIMELINE
        function showTimelinePopup(event) {
            event.stopPropagation();
            const timelineItem = event.currentTarget;
            const stateName = timelineItem.getAttribute('data-state');
            const graphPath = timelineItem.getAttribute('data-graph');

            if (graphPath) {
                const titleMap = {
                    'dispatch': 'Dispatch',
                    'accepted': 'Accepted',
                    'near-pickup': 'Near Pickup',
                    'picked-up': 'Picked Up',
                    'left-pickup': 'Left Pickup',
                    'near-dropoff': 'Near Dropoff'
                };

                document.getElementById('timelinePopupTitle').innerText = titleMap[stateName] || stateName;
                document.getElementById('timelinePopupImage').src = graphPath;
                document.getElementById('timelinePopup').classList.add('active');
                document.getElementById('timelinePopupOverlay').classList.add('active');
            }
        }

        function closeTimelinePopup() {
            document.getElementById('timelinePopup').classList.remove('active');
            document.getElementById('timelinePopupOverlay').classList.remove('active');
        }
    </script>
</body>
</html>